# Meridian Backend æµ‹è¯•è„šæœ¬æŒ‡å—

## æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«Meridian Backendç³»ç»Ÿçš„æµ‹è¯•è„šæœ¬ï¼Œå·²ç»è¿‡ç²¾ç®€ä¼˜åŒ–ï¼Œæä¾›ç®€æ´é«˜æ•ˆçš„æµ‹è¯•ä½“éªŒã€‚

## ğŸ› ï¸ å¯ç”¨è„šæœ¬

### 1. ç»Ÿä¸€ç«¯åˆ°ç«¯æµ‹è¯• - `e2e-test.js`

**åŠŸèƒ½**ï¼šæ”¯æŒä¸¤ç§æ¨¡å¼çš„ç«¯åˆ°ç«¯æµ‹è¯•
- **ç®€åŒ–æ¨¡å¼**ï¼šä½¿ç”¨ç°æœ‰RSSæºè¿›è¡Œæµ‹è¯•ï¼ˆæ¨èï¼‰
- **å®Œæ•´æ¨¡å¼**ï¼šåˆ›å»ºæ–°æºï¼Œå®Œæ•´æµç¨‹æµ‹è¯•ï¼Œå®Œæˆåæ¸…ç†

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# ç®€åŒ–æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰- ä½¿ç”¨ç¬¬ä¸€ä¸ªå¯ç”¨RSSæº
node apps/backend/scripts/e2e-test.js

# ç®€åŒ–æ¨¡å¼ - æŒ‡å®šRSSæºID
node apps/backend/scripts/e2e-test.js simple 1

# å®Œæ•´æ¨¡å¼ - åˆ›å»ºæ–°æºå¹¶æµ‹è¯•
node apps/backend/scripts/e2e-test.js full
```

**æµ‹è¯•æµç¨‹**ï¼š
1. å‡†å¤‡æµ‹è¯•æºï¼ˆæŸ¥æ‰¾ç°æœ‰æº æˆ– åˆ›å»ºæ–°æºï¼‰
2. ç¡®ä¿Durable Objectåˆå§‹åŒ–
3. è§¦å‘RSSæŠ“å–å’Œæ–‡ç« å¤„ç†
4. ç›‘æ§å¤„ç†è¿›åº¦
5. éªŒè¯ç»“æœ
6. æ¸…ç†ï¼ˆä»…å®Œæ•´æ¨¡å¼ï¼‰

### 2. æ•°æ®åº“ç›‘æ§ - `monitor-database.js`

**åŠŸèƒ½**ï¼šå®æ—¶ç›‘æ§æ•°æ®åº“çŠ¶æ€ï¼Œæ˜¾ç¤ºæ–‡ç« å¤„ç†å„é˜¶æ®µè¿›åº¦

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
node apps/backend/scripts/monitor-database.js
```

**ç›‘æ§å†…å®¹**ï¼š
- æ–‡ç« æ€»æ•°åŠçŠ¶æ€åˆ†å¸ƒ
- RSSæºçŠ¶æ€å’Œæœ€åæ£€æŸ¥æ—¶é—´  
- å¤„ç†è¿›åº¦å’Œå¤±è´¥ç»Ÿè®¡
- æœ€è¿‘çš„æ–‡ç« æ´»åŠ¨

### 3. æ•°æ®åº“ç»Ÿè®¡ - `db-stats.sh`

**åŠŸèƒ½**ï¼šå¿«é€Ÿæ˜¾ç¤ºæ•°æ®åº“ç»Ÿè®¡æ¦‚è§ˆ

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
./apps/backend/scripts/db-stats.sh
```

**ç»Ÿè®¡å†…å®¹**ï¼š
- æ ¸å¿ƒæŒ‡æ ‡ï¼ˆæºæ•°é‡ã€æ–‡ç« æ•°é‡ã€å¤„ç†æ•ˆç‡ï¼‰
- æœ€è¿‘æ´»åŠ¨ï¼ˆ7å¤©å†…ï¼‰
- æ–‡ç« çŠ¶æ€åˆ†å¸ƒ
- RSSæºçŠ¶æ€
- é—®é¢˜è¯Šæ–­

### 4. å¿«é€Ÿå¯åŠ¨å™¨ - `quick-test.sh`

**åŠŸèƒ½**ï¼šç»Ÿä¸€çš„æµ‹è¯•å¯åŠ¨å™¨ï¼Œæ•´åˆæ‰€æœ‰æµ‹è¯•åŠŸèƒ½

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# åŸºæœ¬ç”¨æ³•
./apps/backend/scripts/quick-test.sh [test_type] [source_id]

# å…·ä½“ç¤ºä¾‹
./apps/backend/scripts/quick-test.sh simple        # ç®€åŒ–æµ‹è¯•
./apps/backend/scripts/quick-test.sh simple 1      # æŒ‡å®šæºIDæµ‹è¯•
./apps/backend/scripts/quick-test.sh full          # å®Œæ•´æµ‹è¯•
./apps/backend/scripts/quick-test.sh monitor       # å¯åŠ¨ç›‘æ§
./apps/backend/scripts/quick-test.sh stats         # æ˜¾ç¤ºç»Ÿè®¡
```

### 5. æµ‹è¯•æ•°æ®ç”Ÿæˆ - `generate-fixtures.js`

**åŠŸèƒ½**ï¼šç”Ÿæˆæµ‹è¯•fixtureæ•°æ®

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
node apps/backend/scripts/generate-fixtures.js
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

1. **å¯åŠ¨BackendæœåŠ¡**
   ```bash
   cd apps/backend
   wrangler dev
   # æœåŠ¡è¿è¡Œåœ¨ http://localhost:8787
   ```

2. **ç¡®ä¿æ•°æ®åº“è¿è¡Œ**
   ```bash
   # PostgreSQLåº”è¯¥åœ¨è¿è¡Œä¸”å¯è®¿é—®
   export DATABASE_URL="postgresql://user:password@localhost:5432/meridian"
   ```

3. **è®¾ç½®APIè®¤è¯**
   ```bash
   # åœ¨.dev.varsæ–‡ä»¶ä¸­è®¾ç½®
   API_TOKEN=localtest
   ```

### æ¨èæµ‹è¯•æµç¨‹

1. **å¿«é€ŸéªŒè¯**
   ```bash
   ./apps/backend/scripts/quick-test.sh simple
   ```

2. **ç›‘æ§è¿‡ç¨‹**ï¼ˆåœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼‰
   ```bash
   ./apps/backend/scripts/quick-test.sh monitor
   ```

3. **æŸ¥çœ‹ç»Ÿè®¡**
   ```bash
   ./apps/backend/scripts/quick-test.sh stats
   ```

## ğŸ“Š æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šæ—¥å¸¸å¼€å‘éªŒè¯
```bash
# å¿«é€ŸéªŒè¯ç³»ç»ŸåŠŸèƒ½
./apps/backend/scripts/quick-test.sh simple
```

### åœºæ™¯2ï¼šåŠŸèƒ½å®Œæ•´æµ‹è¯•
```bash
# å®Œæ•´ç«¯åˆ°ç«¯éªŒè¯
./apps/backend/scripts/quick-test.sh full
```

### åœºæ™¯3ï¼šè°ƒè¯•ç‰¹å®šRSSæº
```bash
# æµ‹è¯•æŒ‡å®šæº
./apps/backend/scripts/quick-test.sh simple 3

# åŒæ—¶ç›‘æ§å˜åŒ–
./apps/backend/scripts/quick-test.sh monitor
```

### åœºæ™¯4ï¼šç³»ç»ŸçŠ¶æ€æ£€æŸ¥
```bash
# æŸ¥çœ‹å½“å‰çŠ¶æ€
./apps/backend/scripts/quick-test.sh stats
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `DATABASE_URL` | PostgreSQLè¿æ¥å­—ç¬¦ä¸² | `postgresql://postgres:709323@localhost:5432/shiwenjie` |
| `API_TOKEN` | Backend APIè®¤è¯ä»¤ç‰Œ | `localtest` |

### æµ‹è¯•é…ç½®

æµ‹è¯•è„šæœ¬ä¸­çš„é…ç½®å¯ä»¥é€šè¿‡ä¿®æ”¹ `CONFIG` å¯¹è±¡è¿›è¡Œè°ƒæ•´ï¼š

```javascript
const CONFIG = {
  BACKEND_URL: 'http://localhost:8787',
  API_TOKEN: 'localtest',
  POLLING_INTERVAL: 3000,  // ç›‘æ§é—´éš”(æ¯«ç§’)
  MAX_WAIT_TIME: 180000,   // æœ€å¤§ç­‰å¾…æ—¶é—´(æ¯«ç§’)
};
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```
   è§£å†³ï¼šæ£€æŸ¥PostgreSQLæœåŠ¡çŠ¶æ€å’ŒDATABASE_URLé…ç½®
   ```

2. **BackendæœåŠ¡ä¸å¯ç”¨**
   ```
   è§£å†³ï¼šç¡®ä¿ wrangler dev åœ¨localhost:8787è¿è¡Œ
   ```

3. **è®¤è¯å¤±è´¥**
   ```
   è§£å†³ï¼šæ£€æŸ¥.dev.varsæ–‡ä»¶ä¸­çš„API_TOKENè®¾ç½®
   ```

4. **æ²¡æœ‰RSSæº**
   ```
   è§£å†³ï¼šä½¿ç”¨å®Œæ•´æ¨¡å¼æˆ–å…ˆæ‰‹åŠ¨åˆ›å»ºRSSæº
   ```

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
   - æ‰€æœ‰è„šæœ¬æä¾›è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—
   - ä½¿ç”¨æ—¶é—´æˆ³è·Ÿè¸ªæ‰§è¡Œè¿›åº¦

2. **æ‰‹åŠ¨éªŒè¯æœåŠ¡**
   ```bash
   # æ£€æŸ¥APIæœåŠ¡
   curl http://localhost:8787/ping
   
   # æ£€æŸ¥RSSæº
   curl -H "Authorization: Bearer localtest" http://localhost:8787/admin/sources
   ```

3. **åˆ†æ­¥æµ‹è¯•**
   - å…ˆè¿è¡Œç»Ÿè®¡æŸ¥çœ‹å½“å‰çŠ¶æ€
   - å†è¿è¡Œæµ‹è¯•è§‚å¯Ÿå˜åŒ–
   - æœ€åè¿è¡Œç›‘æ§ç¡®è®¤ç»“æœ

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

### è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š

- ç«¯åˆ°ç«¯æµ‹è¯•ä¼šç”ŸæˆJSONæ ¼å¼çš„è¯¦ç»†æŠ¥å‘Š
- æŠ¥å‘ŠåŒ…å«ï¼šæµ‹è¯•æŒç»­æ—¶é—´ã€å„é˜¶æ®µæ‰§è¡Œæ—¶é—´ã€é”™è¯¯è¯¦æƒ…ã€æ•°æ®åº“çŠ¶æ€å˜åŒ–
- æŠ¥å‘Šæ–‡ä»¶æ ¼å¼ï¼š`test-report-{timestamp}.json`

### æˆåŠŸæŒ‡æ ‡

- âœ… RSSæºè¯†åˆ«æˆ–åˆ›å»ºæˆåŠŸ
- âœ… DOåˆå§‹åŒ–å®Œæˆ
- âœ… RSSæŠ“å–è§¦å‘æˆåŠŸ
- âœ… æ–‡ç« å¤„ç†å·¥ä½œæµæ‰§è¡Œ
- âœ… æ•°æ®åº“çŠ¶æ€æ­£å¸¸å˜åŒ–

## ğŸ“ æ–‡ä»¶ç»“æ„

```
apps/backend/scripts/
â”œâ”€â”€ e2e-test.js           # ç»Ÿä¸€ç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬
â”œâ”€â”€ monitor-database.js   # æ•°æ®åº“å®æ—¶ç›‘æ§
â”œâ”€â”€ db-stats.sh          # æ•°æ®åº“ç»Ÿè®¡æ¦‚è§ˆ
â”œâ”€â”€ quick-test.sh        # å¿«é€Ÿæµ‹è¯•å¯åŠ¨å™¨
â”œâ”€â”€ generate-fixtures.js # æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
â””â”€â”€ README.md           # ä½¿ç”¨æŒ‡å—ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## ğŸ”„ ç²¾ç®€è¯´æ˜

æœ¬æµ‹è¯•å¥—ä»¶å·²ç»è¿‡ç²¾ç®€ä¼˜åŒ–ï¼š

- **åˆ é™¤äº†é‡å¤åŠŸèƒ½**ï¼šåˆå¹¶äº†4ä¸ªE2Eæµ‹è¯•è„šæœ¬ä¸º1ä¸ª
- **ç»Ÿä¸€äº†æ¥å£**ï¼šæ‰€æœ‰åŠŸèƒ½é€šè¿‡`quick-test.sh`ç»Ÿä¸€è®¿é—®
- **ç®€åŒ–äº†ç»´æŠ¤**ï¼šå‡å°‘äº†æ–‡ä»¶æ•°é‡ï¼Œé™ä½äº†ç»´æŠ¤å¤æ‚åº¦
- **ä¿æŒäº†åŠŸèƒ½**ï¼šæ‰€æœ‰åŸæœ‰åŠŸèƒ½éƒ½å¾—åˆ°ä¿ç•™

---

*è¿™äº›è„šæœ¬å¸®åŠ©ç¡®ä¿Meridian Backendçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å»ºè®®åœ¨æ¯æ¬¡é‡è¦ä¿®æ”¹åè¿è¡Œç›¸åº”çš„æµ‹è¯•ã€‚* 